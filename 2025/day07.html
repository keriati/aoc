<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Document</title>
</head>
<style>
    html, body {
        margin: 0;
        padding: 0;
        background: #000;
        height: 100%;
        overflow: hidden;
    }
    div {
        color: #00ff66;
        font-family: 'Monaco';
        font-size: 14px;
    }

    canvas {
        display: block;
        background: #000; /* terminal background */
    }
</style>
<body>

<canvas style="float: left" id="terminalCanvas"></canvas>
<div style="float: left" id="counter">asdf</div>

<script>
const input = `......................................................................S......................................................................
.............................................................................................................................................
......................................................................^......................................................................
.............................................................................................................................................
.....................................................................^.^.....................................................................
.............................................................................................................................................
....................................................................^...^....................................................................
.............................................................................................................................................
...................................................................^.^.^.^...................................................................
.............................................................................................................................................
..................................................................^.^...^.^..................................................................
.............................................................................................................................................
.................................................................^...^...^.^.................................................................
.............................................................................................................................................
................................................................^.^.^.^.^...^................................................................
.............................................................................................................................................
...............................................................^.^.^.........^...............................................................
.............................................................................................................................................
..............................................................^.^...^.^.^.^.^.^..............................................................
.............................................................................................................................................
.............................................................^.^...^.^.^.^.....^.............................................................
.............................................................................................................................................
............................................................^.^.......^.^.^.^.^.^............................................................
.............................................................................................................................................
...........................................................^...^...^.^.^.^.^...^.^...........................................................
.............................................................................................................................................
..........................................................^...^.^.^.^.^.^.....^.^.^..........................................................
.............................................................................................................................................
.........................................................^...^...^.^.^...^...^...^.^.........................................................
.............................................................................................................................................
........................................................^.^.^.^...^.^.^...........^.^........................................................
.............................................................................................................................................
.......................................................^...^...^.^.....^.^.........^.^.......................................................
.............................................................................................................................................
......................................................^.^.^...^...^.^.^.^.^.^.^.^.^.^.^......................................................
.............................................................................................................................................
.....................................................^.^...^.^.^.^.^...........^...^.^.^.....................................................
.............................................................................................................................................
....................................................^.^.....^.^.......^.^.^.^.^.^.^...^.^....................................................
.............................................................................................................................................
...................................................^.^.^.^.^.^...^...^.^...^.......^...^.^...................................................
.............................................................................................................................................
..................................................^.^.^.^...^.^.^.^.^.^...^.^.^...^...^.^.^..................................................
.............................................................................................................................................
.................................................^.^...^...^...^.^.^.^.^.^...^.....^.^.^.^.^.................................................
.............................................................................................................................................
................................................^.^.^.^.^.^...^.^.^.^...^.^.^...^.^.^.^.^.^.^................................................
.............................................................................................................................................
...............................................^.^...^.^.^.^.^.^.^.^.......^.^.^.^.^.......^.^...............................................
.............................................................................................................................................
..............................................^.^.^.^.^.^...^.^.^...^.^...^.^...^.^.....^.^.^.^..............................................
.............................................................................................................................................
.............................................^...^.^.^.^...^.^.^.^...^.^...^.......^.^.^.^.^.^.^.............................................
.............................................................................................................................................
............................................^.^.^.^.^.^.^...^.^.^.^.^.^.....^.^.^...^.^.^.^.^.^.^............................................
.............................................................................................................................................
...........................................^.^.^...^.^.....^.^.....^.^.^...^.^...^.^...^...^.^.^.^...........................................
.............................................................................................................................................
..........................................^.^...^.........^.^.^...........^.^.^.^.^.^...^.^...^.^.^..........................................
.............................................................................................................................................
.........................................^.^.......^.^...^.^.^.^.^.....^.^.......^.^.^.........^.^.^.........................................
.............................................................................................................................................
........................................^.^.^.^...^.^.....^.^.^.^.^.^.^.......^.^.....^...^.^.^.^...^........................................
.............................................................................................................................................
.......................................^...^...^.^.^.....^...^.^.^.^.^...^.^...^.......^.^.^.^...^.^.^.......................................
.............................................................................................................................................
......................................^.^.^.^.^.^...^.^.^.............^.....^.^.^.^...^...^...^.^.^.^.^......................................
.............................................................................................................................................
.....................................^.^...........^.^.^.^.^.^...^.^.........^.^.^.^.^.^...^.^...^.^.^.^.....................................
.............................................................................................................................................
....................................^.^.^.^...^...^.^.^...^.......^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.^.^.^....................................
.............................................................................................................................................
...................................^.^.^.^.^.^.^.^...^.^.^.^...^...^...^.^...^...^...^.^...^.^.^.....^.^.^...................................
.............................................................................................................................................
..................................^.^...^...^...^.^.^.^.^...^.^.^.^.^.^...^.....^.^.^...^.^.....^.^...^.^.^..................................
.............................................................................................................................................
.................................^.^...^.^.^...^.^.^.....^.^.^.^.^.^.^...^.^.^.^.^.^.^.^...^.....^...^...^.^.................................
.............................................................................................................................................
................................^.^.^.........^...^.^.^.^...^.....^.^...^.^.^.^...^.....^.....^.^...^.^...^.^................................
.............................................................................................................................................
...............................^.^.^...^.^.......^.^.^.^...^.....^.^.^...^.^.^.^.....^.^...^...^.^...^...^.^.^...............................
.............................................................................................................................................
..............................^.^.^.^.^...^.^.^.^.^.^.^.^.^...^.^...^.....^...^...^...^.^.^.^.^...^.^.....^.^.^..............................
.............................................................................................................................................
.............................^.^.^...^.^.^.^.^.....^...^.^.^.........^.^.^.^.^...^.....^...^.^.^.^.^...^.^.^.^.^.............................
.............................................................................................................................................
............................^.^.^.^.^.^.........^...^.^.^.^.^.......^.^.^.^...^.........^...^.......^.....^.^...^............................
.............................................................................................................................................
...........................^...^.^.^.....^.^...^.......^.^.^.^.......^.^.^.....^.^...^...^.^.^.....^.^.^.....^...^...........................
.............................................................................................................................................
..........................^.^...^.^.^...^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.......^.^.^...^...^...^.....^...^.^...^..........................
.............................................................................................................................................
.........................^...^.^.^...^.^.^.^.^.^.^...^...^...^.^.^.....^.^...^.^.^.^.^.^.^...^.....^.^.^.^.^.^.^.^.^.........................
.............................................................................................................................................
........................^...^.^.^.^.^.^...^.....^...^.^.^.^...^.^.^...^.^.^...^...^.^.^.^.^.^.^.^...^.^.^.....^.^...^........................
.............................................................................................................................................
.......................^...^.^...^.^.....^.^.^.^.^.^...^.^.^.^...^...^.^.....^...^.^.^.^.^...^.^...^.^.^...^...^.^.^.^.......................
.............................................................................................................................................
......................^.^...^.^.^...^...^...^.....^.^.^.^.^.^.^.........^...^.^...^...^...^.^.^...^...^.^.^.^.^.^.^.^.^......................
.............................................................................................................................................
.....................^...^.^.^...^...^.^.....^.^...^.^.^...^.^.^...^.^...^...^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^.^.^.....^.....................
.............................................................................................................................................
....................^.^.^.....^.^...^...^.....^.......^...^.^...^...^...^.....^.^...^.....^.^.^.^.^.^.^...^...^.^.......^....................
.............................................................................................................................................
...................^.^.^.^.^.....^.^.....^.^.^.^.^.^.^.^.^.^.^.^.......^.........^.......^.^.^.....^.^.^.^.^.^.^.^.^.^.^.^...................
.............................................................................................................................................
..................^.^.^.^.^.^.^.^.....^.^.^...^.^.^.^...^...^...^...^.^.^.^.^.^.^.^.......^.^.^.^...^.^.^.^.^...^.^...^...^..................
.............................................................................................................................................
.................^...^.^.^.^...^.^.^...^...^.^.^.^.....^.^.....^...^.^.^.....^.^...^.^.......^.^.^.^.....^...^.^.^.^.^.^.^.^.................
.............................................................................................................................................
................^.^...^.^...^.^.^.....^...^.^.^.^.....^.^.^...^.^.^.^.^.^.^.^.^.......^.^.^.^.^.......^.^...^...^.^.^...^.^.^................
.............................................................................................................................................
...............^.^.......^.^.^...^.^.......^.^.^.^.....^.^.....^.^.^...^...^.^.^...^.^...^.^.^.^...^.^.^.^.^...^.^.^...^...^.^...............
.............................................................................................................................................
..............^...^.^.^.^.......^.^...^.^...^...^...^...^.^...^.^.^.^.^.......^.^.^...^.^.^.^.....^.^.^.....^.^...^.^...^.^.^.^..............
.............................................................................................................................................
.............^.^...^.^.^.....^.....^.....^.^.^...^.^.^.^.^.^.^.^.....^.^...^.^.^...^.^...^...^.......^.^.^.^...^.^.....^...^.^.^.............
.............................................................................................................................................
............^...^.^.......^.............^.^.......^...^.^...^.^.^.^.^...^...^.^.^.....^.^.^.^.^.^...^.^.^.^.^...^.^.^.^.....^.^.^............
.............................................................................................................................................
...........^.^.^.....^.^.^.^.^.^.......^.^.^.^.^.^.^...^.^.^...^.^.^...^...^.^.^.^.^.^...^.^.^.^...^.^.......^.^.^...............^...........
.............................................................................................................................................
..........^.^.^.......^.^...^.^.^...^.^.^.^.....^.^...^.^...^.^.^...^.^.^.^...^.^.^.^...^.^.....^.....^.^.^.....^.^.^.............^..........
.............................................................................................................................................
.........^.^.^.^.^.^.^...^...^.^.^...^.^.^.....^.^.^.^.^.^.........^.^...^.^.^...^.^.^.^.....^.^.^.^.....^...^.....^.^.^.^.^...^.^.^.........
.............................................................................................................................................
........^.^...^.^...^.^.....^.^...^.^.^.........^...^.^.^.....^.^.^.^.^.^.....^.^.....^.^.^.^.....^.^...^.^.^.^.^.^.^.^.....^.^...^.^........
.............................................................................................................................................
.......^.^.^.^.^...^.^...^.^.......^.^...^.^.^.......^...^.^.^.^...^...........^.^.^.^.....^...^...^...^.^.^...^.^.......^.^.^...^.^.^.......
.............................................................................................................................................
......^...^...^.^.^.^.^.^...^...^.^...^...^.^.^.^.^...^.^.^.^.^.^.....^.^.^.^...^.......^.^.^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^......
.............................................................................................................................................
.....^.^...^.....^...^.^.^.^.^...^.^.^.^.....^.^.^.^.^.^.......^.^.^.^...^.....^.^.^.^.^.^.^.^.^.^.^...^...^.^...^.^...^...^.^.^.^.^.^.^.....
.............................................................................................................................................
....^...^.^.^.^...^.^.^.^.^.^.^.^.^.^.^...^...^.^.....^...^.^.......^.^.^.^.....^.^.^...^.^.^...^.....^.........^.^...^.^.^.........^.^.^....
.............................................................................................................................................
...^.^.^.^.^.......^.^.^.^.^...^...^...^...^.^...^.^.^.^.^...^...^...^.^...^.^.^...^.^.^.^.........^.^...^.^...........^.....^...^...^.^.^...
.............................................................................................................................................
..^.^.^...^.^.^.^.^.^.^.^.^.^.^.^.^.^.^.^...^.^.^.^...^.....^...^.^.^.^.^.^.^...^.^.^...^.^.^.^.^.^.^.^...^...^.^.^.^.....^.^.^.^.^.^...^.^..
.............................................................................................................................................
.^.....^.^...^.^.^.....^.^.....^.^...^.^.^.^.^.^.^.^.^.^...^.^...^.....^.^.....^...^.^.^.....^...^.^...^...^.^.....^.^.^.....^...^.^.^.^.^.^.
.............................................................................................................................................`

const map = input.split('\n').map(line => line.split(''));

const canvas = document.getElementById('terminalCanvas');
const ctx = canvas.getContext('2d');

// Style configuration
const fontSize = 12;
const fontFamily = 'monospace';
const bgColor = '#000000';
const activeColor = '#00ff66';   // bright Matrix green
const inactiveColor = '#008833'; // darker green

ctx.font = `${fontSize}px ${fontFamily}`;
ctx.textBaseline = 'top';

let cellWidth;
let cellHeight;

let start = [0, 0];

for (let y = 0; y < map.length; y++) {
  for (let x = 0; x < map[y].length; x++) {
    if (map[y][x] === "S") start = [x, y];
  }
}

function setupCanvasSize() {
  const rows = map.length;
  const cols = map[0].length;

  // Measure width of a typical character for cell width
  ctx.font = `${fontSize}px ${fontFamily}`;
  cellWidth = ctx.measureText('M').width;
  cellHeight = fontSize * 0.8; // little extra vertical spacing

  canvas.width = cols * cellWidth;
  canvas.height = rows * cellHeight;
}

function getRandomPath() {
  const q = [start];
  const path = [];
  const bias = Math.random();

  while (q.length) {
    const [x, y] = q.shift();
    path.push(`${x},${y}`);

    const ny = y + 1;

    if (map[ny]?.[x] === ".") {
      q.push([x, ny]);
      continue;
    }

    if (map[ny]?.[x] === "^") {
      if(Math.random() < bias) {
        q.push([x - 1, ny]);
      } else {
        q.push([x + 1, ny]);
      }
    }
  }

  return path;
}

function clearCanvas() {
  ctx.fillStyle = bgColor;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function drawGrid(time) {
  clearCanvas();

  const randomPath = getRandomPath();

  console.log(randomPath);

  const rows = map.length;
  const cols = map[0].length;

  for (let row = 0; row < rows; row++) {
    for (let col = 0; col < cols; col++) {
      let ch = map[row][col];
      if (!ch || ch === ' ') continue; // skip empty cells if you want

      // Simple flicker/animation:
      // random chance each frame to be "active"

      const x = col * cellWidth;
      const y = row * cellHeight;

      if(randomPath.includes(`${col},${row}`)) {
        ch = '|';
        ctx.fillStyle = activeColor;
      } else {
        ctx.fillStyle = inactiveColor;
      }

      ctx.fillText(ch, x, y);
    }
  }
}
let counter = 0;
const counterDiv = document.getElementById('counter');
function animate(time) {
  drawGrid(time);
counterDiv.innerText = ''+counter;

counter++;
  requestAnimationFrame(animate);
}

// Initialize and start
setupCanvasSize();
clearCanvas();
requestAnimationFrame(animate);

// If you want it to respond to window resizing to fill screen,
// you can recompute size here. Right now it stays exact to grid.
// window.addEventListener('resize', () => {
//   setupCanvasSize();
// });

</script>

</body>
</html>